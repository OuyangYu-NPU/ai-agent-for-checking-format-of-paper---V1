# è®ºæ–‡æ ¼å¼å®¡æŸ¥æ™ºèƒ½ä½“ - é¡¹ç›®æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
3. [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#æ ¸å¿ƒæ¨¡å—è¯¦è§£)
4. [æ•°æ®æµç¨‹](#æ•°æ®æµç¨‹)
5. [å…³é”®æŠ€æœ¯å®ç°](#å…³é”®æŠ€æœ¯å®ç°)
6. [APIæ¥å£è¯´æ˜](#apiæ¥å£è¯´æ˜)
7. [å‰ç«¯åŠŸèƒ½è¯´æ˜](#å‰ç«¯åŠŸèƒ½è¯´æ˜)
8. [æ–‡ä»¶ç»“æ„](#æ–‡ä»¶ç»“æ„)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ç›®æ ‡

è®ºæ–‡æ ¼å¼å®¡æŸ¥æ™ºèƒ½ä½“æ˜¯ä¸€ä¸ªåŸºäºFastAPIå’ŒPyMuPDFçš„æ™ºèƒ½è®ºæ–‡æ ¼å¼å®¡æŸ¥ç³»ç»Ÿï¼Œä¸»è¦ç”¨äºï¼š
- è‡ªåŠ¨è§£æPDFæ ¼å¼çš„å­¦ä½è®ºæ–‡
- æå–è®ºæ–‡ç»“æ„ä¿¡æ¯ï¼ˆå°é¢ã€æ‘˜è¦ã€ç›®å½•ã€ç« èŠ‚ç­‰ï¼‰
- åŸºäºè§„åˆ™å’ŒAIçš„æ ¼å¼å®¡æŸ¥
- ç”Ÿæˆè¯¦ç»†çš„å®¡æŸ¥æŠ¥å‘Š

### æ ¸å¿ƒç‰¹æ€§

1. **å¤šå±‚çº§PDFè§£æ**
   - é¡µçœ‰é¡µè„šè‡ªåŠ¨è¯†åˆ«
   - è¯¦ç»†çš„æ ¼å¼ä¿¡æ¯æå–ï¼ˆå­—ä½“ã€å­—å·ã€è¡Œè·ç­‰ï¼‰
   - å›¾ç‰‡å’Œè¡¨æ ¼è¯†åˆ«
   - ç»“æ„åŒ–çš„JSONè¾“å‡º

2. **æ™ºèƒ½ç»“æ„æå–**
   - åŸºäºé¡µçœ‰çš„ç« èŠ‚ç»“æ„æå–
   - åŸºäºå…³é”®è¯çš„æ–‡æ¡£éƒ¨åˆ†è¯†åˆ«
   - æ”¯æŒè¿ç»­å¤šé¡µçš„å†…å®¹æå–

3. **çµæ´»çš„å®¡æŸ¥ç³»ç»Ÿ**
   - å¯é…ç½®çš„å®¡æŸ¥æ¸…å•
   - è§„åˆ™æ£€æŸ¥å’ŒAIæ·±åº¦åˆ†æ
   - æ”¯æŒç¡•å£«å’Œåšå£«è®ºæ–‡çš„ä¸åŒæ ‡å‡†

4. **å‹å¥½çš„ç”¨æˆ·ç•Œé¢**
   - å®æ—¶è¿›åº¦æ˜¾ç¤º
   - ç»“æ„é¢„è§ˆå’Œå†…å®¹æŸ¥çœ‹
   - äº¤äº’å¼å®¡æŸ¥ç»“æœå±•ç¤º

---

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯ç•Œé¢ (HTML/JS)                   â”‚
â”‚  - æ–‡ä»¶ä¸Šä¼   - ç»“æ„é¢„è§ˆ  - å®¡æŸ¥ç»“æœ  - æ¸…å•é…ç½®          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ HTTP/SSE
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  FastAPI åç«¯æœåŠ¡                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  è·¯ç”±å±‚      â”‚  â”‚  ä¸šåŠ¡é€»è¾‘å±‚   â”‚  â”‚  æ•°æ®è®¿é—®å±‚   â”‚  â”‚
â”‚  â”‚  main.py    â”‚  â”‚  reviewer.py  â”‚  â”‚  pdf_parser  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           â”‚           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PyMuPDF   â”‚ â”‚ OpenAI   â”‚ â”‚ æ–‡ä»¶ç³»ç»Ÿ    â”‚
â”‚ PDFè§£æ   â”‚ â”‚ LLMæœåŠ¡  â”‚ â”‚ JSONå­˜å‚¨    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: FastAPI + Uvicorn
- **PDFå¤„ç†**: PyMuPDF (fitz)
- **æ•°æ®éªŒè¯**: Pydantic
- **AIæœåŠ¡**: OpenAI API (å…¼å®¹æ¥å£)
- **PDFç”Ÿæˆ**: ReportLab
- **å‰ç«¯**: åŸç”ŸHTML/CSS/JavaScript

---

## æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. PDFè§£æå™¨ (`app/pdf_parser.py`)

#### 1.1 æ ¸å¿ƒåŠŸèƒ½

PDFParseræ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒæ¨¡å—ï¼Œè´Ÿè´£å°†PDFæ–‡æ¡£è½¬æ¢ä¸ºç»“æ„åŒ–æ•°æ®ã€‚

#### 1.2 ä¸»è¦æ–¹æ³•

**`load()`** - åŠ è½½PDFæ–‡ä»¶
- ä½¿ç”¨PyMuPDFæ‰“å¼€PDF
- éªŒè¯æ–‡ä»¶å­˜åœ¨æ€§

**`parse(progress_callback=None)`** - è§£æPDFå†…å®¹
- **æ­¥éª¤1**: è‡ªåŠ¨è¯†åˆ«é¡µçœ‰é¡µè„š
  - åˆ†æå‰11é¡µæ ·æœ¬
  - ç»Ÿè®¡é¡µçœ‰é¡µè„šæ–‡æœ¬å‡ºç°é¢‘ç‡
  - è‡ªåŠ¨ç¡®å®šheader_ratioå’Œfooter_ratio
- **æ­¥éª¤2**: é€é¡µè§£æ
  - æå–æ–‡æœ¬å—ï¼ˆä¿ç•™æ ¼å¼ä¿¡æ¯ï¼‰
  - è¯†åˆ«å­—ä½“ã€å­—å·ã€é¢œè‰²ã€ç²—ä½“ã€æ–œä½“
  - åˆ†ç±»å†…å®¹ä½ç½®ï¼ˆé¡µçœ‰/æ­£æ–‡/é¡µè„šï¼‰
  - æå–å›¾ç‰‡å’Œè¡¨æ ¼
- **æ­¥éª¤3**: ä¿å­˜JSONæ–‡ä»¶
  - ç”Ÿæˆè¯¦ç»†çš„JSONæ ¼å¼æ•°æ®
  - åŒ…å«æ¯é¡µçš„markdownæ ¼å¼å†…å®¹
  - ä¿å­˜å›¾ç‰‡ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰

**`extract_paper_info()`** - æå–è®ºæ–‡ç»“æ„ä¿¡æ¯
- **æ­¥éª¤1**: åŸºäºJSONæ–‡ä»¶æå–é¡µçœ‰ç»“æ„
  - ä»å·²ä¿å­˜çš„JSONæ–‡ä»¶ä¸­è¯»å–é¡µçœ‰æ•°æ®
  - ç»Ÿè®¡é¡µçœ‰æ–‡æœ¬é¢‘ç‡ï¼Œæ‰¾å‡ºæœ€å¸¸è§çš„ï¼ˆè®ºæ–‡æ ‡é¢˜ï¼‰
  - ç§»é™¤æœ€å¸¸è§çš„æ–‡æœ¬ï¼Œæå–ç« èŠ‚ç»“æ„
  - å¤„ç†è¿ç»­ç©ºé¡µçœ‰ï¼Œå½’å¹¶åˆ°å‰ä¸€ä¸ªç»“æ„
- **æ­¥éª¤2**: æå–å°é¢ä¿¡æ¯
  - ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–å­¦å·ã€ä½œè€…ã€å­¦é™¢ç­‰
- **æ­¥éª¤3**: ä»sectionsæå–æ‘˜è¦
  - ä¼˜å…ˆä»JSONæ–‡ä»¶çš„markdownæ•°æ®è¯»å–
  - æ”¯æŒè¿ç»­å¤šé¡µçš„æ‘˜è¦æå–
- **æ­¥éª¤4**: æå–å…³é”®è¯å’Œå‚è€ƒæ–‡çŒ®
- **æ­¥éª¤5**: ä¿å­˜å®Œæ•´ç»“æ„åˆ°JSONæ–‡ä»¶

#### 1.3 å…³é”®æŠ€æœ¯ç»†èŠ‚

**é¡µçœ‰é¡µè„šè‡ªåŠ¨è¯†åˆ«ç®—æ³•**:
```python
def _auto_detect_header_footer(self):
    # 1. åˆ†æå‰11é¡µæ ·æœ¬
    # 2. æå–æ¯é¡µé¡µçœ‰é¡µè„šåŒºåŸŸçš„æ–‡æœ¬
    # 3. ç»Ÿè®¡æ–‡æœ¬å‡ºç°é¢‘ç‡
    # 4. å¿½ç•¥é¡µç ï¼Œæ‰¾å‡ºæœ€å¸¸è§çš„æ–‡æœ¬æ¨¡å¼
    # 5. è‡ªåŠ¨ç¡®å®šheader_ratioå’Œfooter_ratio
```

**é¡µçœ‰ç»“æ„æå–ç®—æ³•**:
```python
def _extract_structure_from_headers(json_file_path):
    # 1. ä»JSONæ–‡ä»¶è¯»å–æ‰€æœ‰é¡µé¢çš„é¡µçœ‰æ•°æ®
    # 2. ç»Ÿè®¡é¡µçœ‰æ–‡æœ¬é¢‘ç‡
    # 3. æ‰¾å‡ºæœ€å¸¸è§çš„æ–‡æœ¬ï¼ˆè®ºæ–‡æ ‡é¢˜ï¼‰
    # 4. ä»æ‰€æœ‰é¡µçœ‰ä¸­ç§»é™¤æœ€å¸¸è§çš„æ–‡æœ¬
    # 5. æå–å‰©ä½™çš„é¡µçœ‰ä½œä¸ºç« èŠ‚ç»“æ„
    # 6. å¤„ç†è¿ç»­ç©ºé¡µçœ‰ï¼Œå½’å¹¶åˆ°å‰ä¸€ä¸ªç»“æ„
    # 7. è®°å½•æ¯ä¸ªç»“æ„çš„start_pageå’Œend_page
```

**è¿ç»­å¤šé¡µå†…å®¹å½’å¹¶é€»è¾‘**:
```python
# éå†æ‰€æœ‰é¡µé¢ï¼ˆåŒ…æ‹¬ç©ºé¡µçœ‰ï¼‰
for item in cleaned_headers:
    if header_text:
        # æœ‰é¡µçœ‰æ–‡æœ¬ï¼šåˆ›å»ºæ–°ç»“æ„æˆ–æ›´æ–°å½“å‰ç»“æ„
        if current_structure and header_text != current_structure["header_text"]:
            # æ–°ç»“æ„ï¼Œä¿å­˜å‰ä¸€ä¸ª
            deduplicated_structure.append(current_structure)
            current_structure = new_structure
        else:
            # ç›¸åŒç»“æ„ï¼Œæ›´æ–°ç»“æŸé¡µ
            current_structure["end_page"] = page_idx
    else:
        # ç©ºé¡µçœ‰ï¼šå½’å¹¶åˆ°å½“å‰ç»“æ„
        if current_structure:
            current_structure["end_page"] = page_idx
```

### 2. æ–‡æ¡£ç»“æ„åˆ†æå™¨ (`app/document_structure.py`)

#### 2.1 æ ¸å¿ƒåŠŸèƒ½

DocumentAnalyzerè´Ÿè´£è¯†åˆ«æ–‡æ¡£çš„é€»è¾‘ç»“æ„ï¼ˆå°é¢ã€æ‘˜è¦ã€ç›®å½•ã€æ­£æ–‡ç­‰ï¼‰ã€‚

#### 2.2 ä¸»è¦æ–¹æ³•

**`analyze()`** - åˆ†ææ–‡æ¡£ç»“æ„
- è¯†åˆ«å„éƒ¨åˆ†ï¼ˆå°é¢ã€æ‘˜è¦ã€ç›®å½•ç­‰ï¼‰
- æå–ç›®å½•å’Œç« èŠ‚ä¿¡æ¯
- ç²¾åŒ–ç« èŠ‚ä¿¡æ¯
- æå–å„éƒ¨åˆ†å†…å®¹

**`_identify_sections()`** - è¯†åˆ«æ–‡æ¡£å„éƒ¨åˆ†
- ä½¿ç”¨å…³é”®è¯åŒ¹é…è¯†åˆ«å„éƒ¨åˆ†
- **ä¼˜åŒ–åçš„åˆå¹¶é€»è¾‘**:
  1. æŒ‰ç±»å‹åˆ†ç»„æ‰€æœ‰é¡µé¢
  2. åˆå¹¶è¿ç»­çš„é¡µé¢ï¼ˆ3é¡µå†…è§†ä¸ºè¿ç»­ï¼‰
  3. åˆå¹¶æ¥è¿‘çš„èŒƒå›´ï¼ˆ10é¡µå†…ï¼‰
  4. å¯¹äºç›®å½•/æ­£æ–‡/é™„å½•ï¼šåªä¿ç•™æœ€å¤§çš„èŒƒå›´
  5. é¿å…é‡å¤çš„sections

**`_extract_toc_and_chapters()`** - æå–ç›®å½•å’Œç« èŠ‚
- ä»ç›®å½•é¡µæå–ç« èŠ‚ä¿¡æ¯
- ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç« èŠ‚ç¼–å·å’Œæ ‡é¢˜

#### 2.3 å…³é”®è¯é…ç½®

```python
SECTION_KEYWORDS = {
    SectionType.COVER: ["è¥¿å®‰å»ºç­‘ç§‘æŠ€å¤§å­¦", "å­¦ä½è®ºæ–‡", "åšå£«å­¦ä½", "ç¡•å£«å­¦ä½"],
    SectionType.ABSTRACT_CN: ["æ‘˜è¦", "æ‘˜ è¦"],
    SectionType.ABSTRACT_EN: ["Abstract", "ABSTRACT"],
    SectionType.TOC: ["ç›®å½•", "ç›® å½•", "Contents", "CONTENTS"],
    # ... æ›´å¤šç±»å‹
}
```

### 3. å®¡æŸ¥å¼•æ“ (`app/reviewer.py`)

#### 3.1 æ ¸å¿ƒåŠŸèƒ½

PaperReviewerè´Ÿè´£æ‰§è¡Œæ ¼å¼å®¡æŸ¥ï¼Œåº”ç”¨æ£€æŸ¥æ¸…å•ä¸­çš„è§„åˆ™ã€‚

#### 3.2 å®¡æŸ¥æµç¨‹

1. **åŠ è½½æ£€æŸ¥æ¸…å•**
   - ä»ChecklistManagerè·å–å¯ç”¨çš„æ£€æŸ¥é¡¹
   - æ ¹æ®å­¦ä½ç±»å‹ï¼ˆç¡•å£«/åšå£«ï¼‰è¿‡æ»¤æ£€æŸ¥é¡¹

2. **æ‰§è¡Œå„é¡¹æ£€æŸ¥**
   - å°é¢ä¿¡æ¯æ£€æŸ¥
   - æ‘˜è¦é•¿åº¦æ£€æŸ¥ï¼ˆç¡•å£«700-1000å­—ï¼Œåšå£«1000-1500å­—ï¼‰
   - å…³é”®è¯æ£€æŸ¥
   - é¡µæ•°æ£€æŸ¥
   - å›¾è¡¨æ£€æŸ¥ï¼ˆå¯é€‰ï¼‰
   - å‚è€ƒæ–‡çŒ®æ£€æŸ¥

3. **ç”Ÿæˆå®¡æŸ¥ç»“æœ**
   - è®¡ç®—æ€»åˆ†
   - åˆ†ç±»é—®é¢˜ï¼ˆæ ¼å¼/å†…å®¹/ç»“æ„ï¼‰
   - ç”ŸæˆReviewResultå¯¹è±¡

### 4. LLMæœåŠ¡ (`app/llm_service.py`)

#### 4.1 æ ¸å¿ƒåŠŸèƒ½

æä¾›AIæ·±åº¦åˆ†æåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- ç»¼åˆå®¡æŸ¥ï¼ˆåˆå¹¶å¤šä¸ªæ£€æŸ¥é¡¹ï¼Œå‡å°‘APIè°ƒç”¨ï¼‰
- é”™åˆ«å­—æ£€æŸ¥
- å­¦æœ¯å†™ä½œé£æ ¼åˆ†æ
- å†…å®¹è´¨é‡è¯„ä¼°

#### 4.2 ä¼˜åŒ–ç­–ç•¥

**å‡å°‘APIè°ƒç”¨**:
- å°†å¤šä¸ªæ£€æŸ¥é¡¹åˆå¹¶ä¸ºä¸€ä¸ª"ç»¼åˆå®¡æŸ¥"è¯·æ±‚
- ä½¿ç”¨markdownæ ¼å¼è¿”å›ï¼Œç„¶åè½¬æ¢ä¸ºçº¯æ–‡æœ¬

### 5. æŠ¥å‘Šç”Ÿæˆå™¨ (`app/report_generator.py`)

#### 5.1 æ ¸å¿ƒåŠŸèƒ½

ç”Ÿæˆå®¡æŸ¥æŠ¥å‘Šï¼Œæ”¯æŒå¤šç§æ ¼å¼ï¼š
- æ–‡æœ¬æŠ¥å‘Š
- HTMLæŠ¥å‘Š
- **PDFæŠ¥å‘Š**ï¼ˆä½¿ç”¨ReportLabï¼‰
  - æ³¨å†Œä¸­æ–‡å­—ä½“ï¼ˆSimSunã€Microsoft YaHeiç­‰ï¼‰
  - åªåŒ…å«å®¡æŸ¥ç»“æœï¼ˆä¸åŒ…å«è®ºæ–‡ä¿¡æ¯å’ŒAIåˆ†æï¼‰
  - æ”¯æŒä¸­æ–‡æ˜¾ç¤º

### 6. æ£€æŸ¥æ¸…å•ç®¡ç† (`app/checklist.py`)

#### 6.1 æ ¸å¿ƒåŠŸèƒ½

ç®¡ç†å¯é…ç½®çš„å®¡æŸ¥æ¸…å•ï¼Œæ”¯æŒï¼š
- å¯ç”¨/ç¦ç”¨æ£€æŸ¥é¡¹
- æŒ‰ç±»åˆ«åˆ†ç»„
- æŒ‰å­¦ä½ç±»å‹è¿‡æ»¤ï¼ˆç¡•å£«/åšå£«/å…¨éƒ¨ï¼‰
- æ£€æŸ¥ç±»å‹åˆ†ç±»ï¼ˆè§„åˆ™æ£€æŸ¥/LLMæ£€æŸ¥/æ‰‹åŠ¨æ£€æŸ¥ï¼‰

---

## æ•°æ®æµç¨‹

### 1. PDFä¸Šä¼ å’Œè§£ææµç¨‹

```
ç”¨æˆ·ä¸Šä¼ PDF
    â†“
ä¿å­˜åˆ°uploads/pdf_YYYYMMDD_HHMMSS/ç›®å½•
    â†“
PDFParser.load() - åŠ è½½PDF
    â†“
PDFParser.parse() - è§£æPDF
    â”œâ”€ è‡ªåŠ¨è¯†åˆ«é¡µçœ‰é¡µè„š
    â”œâ”€ é€é¡µæå–å†…å®¹
    â”‚   â”œâ”€ æå–æ–‡æœ¬å—ï¼ˆæ ¼å¼ä¿¡æ¯ï¼‰
    â”‚   â”œâ”€ åˆ†ç±»ä½ç½®ï¼ˆé¡µçœ‰/æ­£æ–‡/é¡µè„šï¼‰
    â”‚   â”œâ”€ æå–å›¾ç‰‡å’Œè¡¨æ ¼
    â”‚   â””â”€ ç”Ÿæˆmarkdownæ ¼å¼å†…å®¹
    â”œâ”€ ä¿å­˜JSONæ–‡ä»¶: {PDFæ–‡ä»¶å}.json
    â””â”€ ä¿å­˜è§£æç»“æœ: {PDFæ–‡ä»¶å}_parse_result_{æ—¶é—´æˆ³}.json
    â†“
PDFParser.extract_paper_info() - æå–è®ºæ–‡ç»“æ„
    â”œâ”€ ä»JSONæ–‡ä»¶æå–é¡µçœ‰ç»“æ„
    â”œâ”€ æå–å°é¢ä¿¡æ¯
    â”œâ”€ ä»sectionsæå–æ‘˜è¦ï¼ˆä»JSONçš„markdownæ•°æ®ï¼‰
    â”œâ”€ æå–å…³é”®è¯å’Œå‚è€ƒæ–‡çŒ®
    â””â”€ ä¿å­˜å®Œæ•´ç»“æ„: {PDFæ–‡ä»¶å}_structure_{æ—¶é—´æˆ³}.json
```

### 2. ç»“æ„æå–æµç¨‹

```
PDFè§£æå®Œæˆï¼ŒJSONæ–‡ä»¶å·²ä¿å­˜
    â†“
extract_paper_info()
    â†“
_extract_structure_from_headers(json_file_path)
    â”œâ”€ è¯»å–JSONæ–‡ä»¶
    â”œâ”€ æå–æ‰€æœ‰é¡µé¢çš„é¡µçœ‰æ•°æ®ï¼ˆåŒ…æ‹¬ç©ºé¡µçœ‰ï¼‰
    â”œâ”€ ç»Ÿè®¡é¡µçœ‰æ–‡æœ¬é¢‘ç‡
    â”œâ”€ æ‰¾å‡ºæœ€å¸¸è§çš„æ–‡æœ¬ï¼ˆè®ºæ–‡æ ‡é¢˜ï¼‰
    â”œâ”€ ç§»é™¤æœ€å¸¸è§çš„æ–‡æœ¬
    â”œâ”€ æå–ç« èŠ‚ç»“æ„
    â””â”€ å¤„ç†è¿ç»­ç©ºé¡µçœ‰ï¼Œå½’å¹¶åˆ°å‰ä¸€ä¸ªç»“æ„
    â†“
DocumentAnalyzer.analyze()
    â”œâ”€ è¯†åˆ«æ–‡æ¡£å„éƒ¨åˆ†ï¼ˆå°é¢ã€æ‘˜è¦ã€ç›®å½•ç­‰ï¼‰
    â”œâ”€ åˆå¹¶ç›¸é‚»çš„åŒç±»å‹sections
    â””â”€ æå–ç›®å½•å’Œç« èŠ‚ä¿¡æ¯
    â†“
ä¿å­˜PaperStructureåˆ°JSONæ–‡ä»¶
```

### 3. æ‘˜è¦æå–æµç¨‹ï¼ˆä¼˜åŒ–åï¼‰

```
extract_paper_info()
    â†“
_extract_abstract_from_sections()
    â”œâ”€ æŸ¥æ‰¾abstract_cnç±»å‹çš„section
    â”œâ”€ ä»JSONæ–‡ä»¶è¯»å–å¯¹åº”é¡µé¢çš„body.markdown
    â”œâ”€ åˆå¹¶æ‰€æœ‰é¡µé¢çš„markdownå†…å®¹
    â”œâ”€ ç§»é™¤"æ‘˜è¦"æ ‡é¢˜å’Œç»“æŸæ ‡è®°
    â””â”€ æ¸…ç†markdownæ ¼å¼ï¼Œè½¬æ¢ä¸ºçº¯æ–‡æœ¬
    â†“
å¦‚æœsectionsä¸­æ²¡æœ‰ï¼Œå›é€€åˆ°_extract_abstract_cn()
    â””â”€ ä»page_textsä¸­æå–ï¼ˆæ”¯æŒè¿ç»­å¤šé¡µï¼‰
```

### 4. å®¡æŸ¥æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»"å¼€å§‹å®¡æŸ¥"
    â†“
åŠ è½½PaperStructureï¼ˆä»_structure.jsonæ–‡ä»¶ï¼‰
    â†“
PaperReviewer.review()
    â”œâ”€ åŠ è½½å¯ç”¨çš„æ£€æŸ¥é¡¹
    â”œâ”€ æ‰§è¡Œå„é¡¹æ£€æŸ¥
    â”‚   â”œâ”€ å°é¢ä¿¡æ¯æ£€æŸ¥
    â”‚   â”œâ”€ æ‘˜è¦é•¿åº¦æ£€æŸ¥
    â”‚   â”œâ”€ å…³é”®è¯æ£€æŸ¥
    â”‚   â”œâ”€ é¡µæ•°æ£€æŸ¥
    â”‚   â”œâ”€ å›¾è¡¨æ£€æŸ¥ï¼ˆå¦‚æœå¯ç”¨ï¼‰
    â”‚   â””â”€ å‚è€ƒæ–‡çŒ®æ£€æŸ¥
    â””â”€ ç”ŸæˆReviewResult
    â†“
å¦‚æœå¯ç”¨AIå®¡æŸ¥
    â”œâ”€ llm_service.comprehensive_review()
    â””â”€ åˆå¹¶AIåˆ†æç»“æœ
    â†“
ä¿å­˜å®¡æŸ¥ç»“æœ: {PDFæ–‡ä»¶å}_review.json
```

---

## å…³é”®æŠ€æœ¯å®ç°

### 1. é¡µçœ‰é¡µè„šè‡ªåŠ¨è¯†åˆ«

**ç®—æ³•æ€è·¯**:
1. åˆ†æå‰11é¡µæ ·æœ¬ï¼ˆè¦†ç›–æ–‡æ¡£å¼€å¤´ï¼‰
2. æå–æ¯é¡µé¡µçœ‰é¡µè„šåŒºåŸŸçš„æ–‡æœ¬
3. ç»Ÿè®¡æ–‡æœ¬å‡ºç°é¢‘ç‡
4. å¿½ç•¥é¡µç ï¼ˆä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤ï¼‰
5. æ‰¾å‡ºæœ€å¸¸è§çš„æ–‡æœ¬æ¨¡å¼
6. è‡ªåŠ¨ç¡®å®šheader_ratioå’Œfooter_ratio

**å…³é”®ä»£ç **:
```python
def _auto_detect_header_footer(self):
    sample_pages = min(11, total_pages)
    header_texts = []
    footer_texts = []
    
    for page_idx in range(sample_pages):
        # æå–é¡µçœ‰é¡µè„šæ–‡æœ¬
        # ç§»é™¤é¡µç 
        # ç»Ÿè®¡é¢‘ç‡
    
    # æ‰¾å‡ºæœ€å¸¸è§çš„æ–‡æœ¬
    most_common_header = Counter(header_texts).most_common(1)[0]
    # è‡ªåŠ¨ç¡®å®šæ¯”ä¾‹
```

### 2. é¡µçœ‰ç»“æ„æå–

**ç®—æ³•æ€è·¯**:
1. ä»JSONæ–‡ä»¶è¯»å–æ‰€æœ‰é¡µé¢çš„é¡µçœ‰æ•°æ®ï¼ˆåŒ…æ‹¬ç©ºé¡µçœ‰ï¼‰
2. ç»Ÿè®¡é¡µçœ‰æ–‡æœ¬å‡ºç°é¢‘ç‡
3. æ‰¾å‡ºæœ€å¸¸è§çš„æ–‡æœ¬ï¼ˆé€šå¸¸æ˜¯è®ºæ–‡æ ‡é¢˜ï¼‰
4. ä»æ‰€æœ‰é¡µçœ‰ä¸­ç§»é™¤æœ€å¸¸è§çš„æ–‡æœ¬
5. æå–å‰©ä½™çš„é¡µçœ‰ä½œä¸ºç« èŠ‚ç»“æ„
6. **å…³é”®ä¼˜åŒ–**: å¤„ç†è¿ç»­ç©ºé¡µçœ‰ï¼Œå½’å¹¶åˆ°å‰ä¸€ä¸ªç»“æ„

**è¿ç»­ç©ºé¡µçœ‰å¤„ç†**:
```python
for item in cleaned_headers:
    if header_text:
        # æœ‰é¡µçœ‰æ–‡æœ¬
        if current_structure and header_text != current_structure["header_text"]:
            # æ–°ç»“æ„ï¼Œä¿å­˜å‰ä¸€ä¸ª
            deduplicated_structure.append(current_structure)
            current_structure = new_structure
        else:
            # ç›¸åŒç»“æ„ï¼Œæ›´æ–°ç»“æŸé¡µ
            current_structure["end_page"] = page_idx
    else:
        # ç©ºé¡µçœ‰ï¼šå½’å¹¶åˆ°å½“å‰ç»“æ„
        if current_structure:
            current_structure["end_page"] = page_idx
```

### 3. Sectionsåˆå¹¶ä¼˜åŒ–

**é—®é¢˜**: ç›®å½•è·¨è¶Šå¤šé¡µæ—¶ï¼Œæ¯é¡µéƒ½è¢«è¯†åˆ«ä¸ºä¸€ä¸ªsectionï¼Œå¯¼è‡´69ä¸ªéƒ¨åˆ†

**è§£å†³æ–¹æ¡ˆ**:
1. æŒ‰ç±»å‹åˆ†ç»„æ‰€æœ‰é¡µé¢
2. åˆå¹¶è¿ç»­çš„é¡µé¢ï¼ˆ3é¡µå†…è§†ä¸ºè¿ç»­ï¼‰
3. åˆå¹¶æ¥è¿‘çš„èŒƒå›´ï¼ˆ10é¡µå†…ï¼‰
4. å¯¹äºç›®å½•/æ­£æ–‡/é™„å½•ï¼šåªä¿ç•™æœ€å¤§çš„èŒƒå›´
5. é¿å…é‡å¤çš„sections

**å…³é”®ä»£ç **:
```python
# æŒ‰ç±»å‹åˆ†ç»„
sections_by_type = {}
for section_info in found_sections:
    section_type = section_info["type"]
    sections_by_type[section_type].append(section_info["page"])

# åˆå¹¶è¿ç»­çš„é¡µé¢
for section_type, pages in sections_by_type.items():
    pages = sorted(set(pages))
    # åˆå¹¶è¿ç»­é¡µé¢ï¼ˆ3é¡µå†…ï¼‰
    # å¯¹äºç›®å½•/æ­£æ–‡/é™„å½•ï¼šåªä¿ç•™æœ€å¤§çš„èŒƒå›´
    if section_type in [TOC, BODY, APPENDIX] and len(final_ranges) > 1:
        largest_range = max(final_ranges, key=lambda r: r[1] - r[0])
        final_ranges = [largest_range]
```

### 4. æ‘˜è¦æå–ä¼˜åŒ–

**ä»sectionsæå–ï¼ˆä¼˜å…ˆæ–¹æ³•ï¼‰**:
```python
def _extract_abstract_from_sections(self, structure):
    # 1. æŸ¥æ‰¾abstract_cnç±»å‹çš„section
    # 2. ä»JSONæ–‡ä»¶è¯»å–å¯¹åº”é¡µé¢çš„body.markdown
    # 3. åˆå¹¶æ‰€æœ‰é¡µé¢çš„markdownå†…å®¹
    # 4. ç§»é™¤"æ‘˜è¦"æ ‡é¢˜å’Œç»“æŸæ ‡è®°
    # 5. æ¸…ç†markdownæ ¼å¼ï¼Œè½¬æ¢ä¸ºçº¯æ–‡æœ¬
```

**æ”¯æŒè¿ç»­å¤šé¡µ**:
```python
def _extract_abstract_cn(self, structure):
    # æ‰¾åˆ°"æ‘˜è¦"æ ‡è®°å
    # ç»§ç»­è¯»å–åç»­é¡µé¢ï¼Œç›´åˆ°æ‰¾åˆ°ç»“æŸæ ‡è®°
    # æœ€å¤šè¯»å–10é¡µï¼ˆé˜²æ­¢æ— é™å¾ªç¯ï¼‰
    for j in range(i + 1, min(i + 11, len(self.page_texts))):
        # æ£€æŸ¥æ˜¯å¦æœ‰ç»“æŸæ ‡è®°
        # å¦‚æœæœ‰ï¼Œæ·»åŠ è¯¥é¡µåˆ°ç»“æŸæ ‡è®°ä¹‹å‰çš„å†…å®¹
        # å¦‚æœæ²¡æœ‰ï¼Œæ·»åŠ æ•´é¡µå†…å®¹
```

### 5. JSONæ–‡ä»¶ç»“æ„

**é¡µé¢æ•°æ®ç»“æ„**:
```json
{
  "pages": [
    {
      "page_number": 1,
      "header": {
        "markdown": "...",
        "raw_text": "...",
        "elements": [...]
      },
      "body": {
        "markdown": "...",
        "raw_text": "...",
        "elements": [...]
      },
      "footer": {
        "markdown": "...",
        "raw_text": "...",
        "elements": [...]
      }
    }
  ]
}
```

**ç»“æ„æ–‡ä»¶** (`_structure.json`):
```json
{
  "title": "...",
  "abstract_cn": "...",
  "chapters": [
    {
      "title": "...",
      "start_page": 5,
      "end_page": 6,
      "level": 1,
      "number": "ç¬¬ä¸€ç« "
    }
  ],
  "sections": [
    {
      "type": "abstract_cn",
      "title": "æ‘˜è¦",
      "start_page": 5,
      "end_page": 6
    }
  ]
}
```

---

## APIæ¥å£è¯´æ˜

### 1. æ–‡ä»¶ä¸Šä¼ 

**`POST /api/upload-with-progress`**
- åŠŸèƒ½: ä¸Šä¼ PDFæ–‡ä»¶å¹¶è¿”å›è§£æè¿›åº¦ï¼ˆSSEï¼‰
- è¿”å›: Server-Sent Eventsæµï¼Œå®æ—¶æ›´æ–°è¿›åº¦
- è¿›åº¦æ­¥éª¤:
  - ä¸Šä¼ å®Œæˆ (20%)
  - è§£æPDF (30-70%)
  - ä¿å­˜JSON (75%)
  - æå–ç»“æ„ (80%)
  - å®Œæˆ (100%)

### 2. è®ºæ–‡ä¿¡æ¯

**`GET /api/paper-info?paper_path=...`**
- åŠŸèƒ½: è·å–è®ºæ–‡ç»“æ„ä¿¡æ¯
- è¿”å›: PaperStructureçš„JSONè¡¨ç¤º
- åŒ…å«: å°é¢ä¿¡æ¯ã€æ‘˜è¦ã€å…³é”®è¯ã€ç« èŠ‚ã€sectionsç­‰

### 3. ç« èŠ‚å†…å®¹

**`GET /api/chapter-content?paper_path=...&start_page=...&end_page=...`**
- åŠŸèƒ½: è·å–ç« èŠ‚å…¨æ–‡å†…å®¹ï¼ˆä»JSONæ–‡ä»¶çš„markdownæ•°æ®ï¼‰
- å‚æ•°:
  - `paper_path`: PDFæ–‡ä»¶è·¯å¾„
  - `start_page`: èµ·å§‹é¡µï¼ˆ0-basedï¼‰
  - `end_page`: ç»“æŸé¡µï¼ˆ0-basedï¼‰
- è¿”å›: markdownæ ¼å¼çš„å†…å®¹
- **è·¯å¾„å¤„ç†ä¼˜åŒ–**:
  - æ”¯æŒå¤šç§è·¯å¾„æ ¼å¼ï¼ˆWindows/Unixï¼‰
  - å¦‚æœæ‰¾ä¸åˆ°PDFæ–‡ä»¶ï¼Œç›´æ¥æŸ¥æ‰¾JSONæ–‡ä»¶
  - æ”¯æŒæ–‡ä»¶åæ¨¡ç³ŠåŒ¹é…

### 4. å®¡æŸ¥

**`POST /api/review`**
- åŠŸèƒ½: æ‰§è¡Œè®ºæ–‡æ ¼å¼å®¡æŸ¥
- å‚æ•°:
  - `paper_path`: PDFæ–‡ä»¶è·¯å¾„
  - `use_ai`: æ˜¯å¦ä½¿ç”¨AIå®¡æŸ¥
  - `degree_type`: å­¦ä½ç±»å‹ï¼ˆmaster/phdï¼‰
- è¿”å›: ReviewResultå¯¹è±¡

### 5. PDFæŠ¥å‘Šå¯¼å‡º

**`GET /api/export-pdf-report?paper_path=...`**
- åŠŸèƒ½: å¯¼å‡ºPDFæ ¼å¼çš„å®¡æŸ¥æŠ¥å‘Š
- è¿”å›: PDFæ–‡ä»¶æµ
- **ä¸­æ–‡å­—ä½“å¤„ç†**: è‡ªåŠ¨æ³¨å†Œç³»ç»Ÿå­—ä½“ï¼ˆSimSunã€Microsoft YaHeiç­‰ï¼‰

---

## å‰ç«¯åŠŸèƒ½è¯´æ˜

### 1. æ–‡ä»¶ä¸Šä¼ 

- **æ‹–æ‹½ä¸Šä¼ **: æ”¯æŒæ‹–æ‹½PDFæ–‡ä»¶åˆ°ä¸Šä¼ åŒºåŸŸ
- **è¿›åº¦æ˜¾ç¤º**: å®æ—¶æ˜¾ç¤ºPDFè§£æè¿›åº¦ï¼ˆSSEï¼‰
- **è‡ªåŠ¨åˆ‡æ¢**: ä¸Šä¼ å®Œæˆåè‡ªåŠ¨åˆ‡æ¢åˆ°ç»“æ„é¢„è§ˆé¡µé¢

### 2. ç»“æ„é¢„è§ˆ

- **å°é¢ä¿¡æ¯**: æ˜¾ç¤ºæå–çš„å°é¢ä¿¡æ¯
- **æ‘˜è¦ä¿¡æ¯**: 
  - æ˜¾ç¤ºæ‘˜è¦å†…å®¹ï¼ˆå‰500å­—ç¬¦ï¼‰
  - æ˜¾ç¤ºé¡µç èŒƒå›´
  - ç‚¹å‡»"æŸ¥çœ‹å…¨æ–‡"æŸ¥çœ‹å®Œæ•´å†…å®¹
- **æ–‡æ¡£ç»“æ„**: 
  - åˆ—å‡ºæ‰€æœ‰sections
  - æ˜¾ç¤ºç±»å‹å›¾æ ‡å’Œé¡µç èŒƒå›´
  - ç‚¹å‡»å¯æŸ¥çœ‹å®Œæ•´å†…å®¹
- **ç« èŠ‚ç›®å½•**: 
  - æ˜¾ç¤ºç« èŠ‚å±‚çº§ç»“æ„
  - æ”¯æŒå±‚çº§ç¼©è¿›
  - ç‚¹å‡»å¯æŸ¥çœ‹ç« èŠ‚å…¨æ–‡

### 3. å†…å®¹æŸ¥çœ‹æ¨¡æ€æ¡†

- **åŠŸèƒ½**: ç‚¹å‡»ç« èŠ‚æˆ–sectionåå¼¹å‡ºæ¨¡æ€æ¡†
- **å†…å®¹æ¥æº**: ä»JSONæ–‡ä»¶çš„markdownæ•°æ®è¯»å–
- **æ¸²æŸ“**: ç®€å•çš„markdownæ¸²æŸ“ï¼ˆæ ‡é¢˜ã€ç²—ä½“ã€ä»£ç å—ç­‰ï¼‰
- **äº¤äº’**: 
  - ç‚¹å‡»å¤–éƒ¨åŒºåŸŸå…³é—­
  - æŒ‰ESCé”®å…³é—­
  - æ˜¾ç¤ºé¡µç èŒƒå›´ä¿¡æ¯

### 4. å®¡æŸ¥ç»“æœ

- **ç»Ÿè®¡ä¿¡æ¯**: æ˜¾ç¤ºæ€»åˆ†ã€é—®é¢˜æ•°é‡ç­‰
- **é—®é¢˜åˆ†ç±»**: æŒ‰æ ¼å¼/å†…å®¹/ç»“æ„åˆ†ç±»
- **ä¸¥é‡ç¨‹åº¦**: é«˜/ä¸­/ä½ä¼˜å…ˆçº§
- **AIåˆ†æ**: å¯é€‰çš„AIæ·±åº¦åˆ†æç»“æœ

---

## æ–‡ä»¶ç»“æ„

```
paper/
â”œâ”€â”€ app/                          # åº”ç”¨æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ models.py                 # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ pdf_parser.py            # PDFè§£æå™¨ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ document_structure.py    # æ–‡æ¡£ç»“æ„åˆ†æå™¨
â”‚   â”œâ”€â”€ reviewer.py              # å®¡æŸ¥å¼•æ“
â”‚   â”œâ”€â”€ llm_service.py           # LLMæœåŠ¡
â”‚   â”œâ”€â”€ checklist.py             # æ£€æŸ¥æ¸…å•ç®¡ç†
â”‚   â”œâ”€â”€ report_generator.py      # æŠ¥å‘Šç”Ÿæˆå™¨
â”‚   â””â”€â”€ config.py                # é…ç½®ç®¡ç†
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html               # å‰ç«¯ç•Œé¢
â”œâ”€â”€ uploads/                     # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ pdf_YYYYMMDD_HHMMSS/    # æŒ‰æ—¶é—´æˆ³ç»„ç»‡çš„ä¸Šä¼ ç›®å½•
â”‚       â”œâ”€â”€ {PDFæ–‡ä»¶å}.pdf
â”‚       â”œâ”€â”€ {PDFæ–‡ä»¶å}.json              # è¯¦ç»†è§£æç»“æœ
â”‚       â”œâ”€â”€ {PDFæ–‡ä»¶å}_parse_result_*.json  # è§£æç»Ÿè®¡
â”‚       â”œâ”€â”€ {PDFæ–‡ä»¶å}_structure_*.json     # è®ºæ–‡ç»“æ„
â”‚       â””â”€â”€ {PDFæ–‡ä»¶å}_review.json          # å®¡æŸ¥ç»“æœ
â”œâ”€â”€ logs/                        # æ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ paper_review_YYYYMMDD.log      # ä¸»æ—¥å¿—
â”‚   â”œâ”€â”€ pdf_parsing_YYYYMMDD.log      # PDFè§£ææ—¥å¿—
â”‚   â”œâ”€â”€ review_process_YYYYMMDD.log   # å®¡æŸ¥è¿‡ç¨‹æ—¥å¿—
â”‚   â”œâ”€â”€ llm_calls_YYYYMMDD.log        # LLMè°ƒç”¨æ—¥å¿—
â”‚   â””â”€â”€ pdf_fulltext_YYYYMMDD_HHMMSS.txt  # PDFå…¨æ–‡
â”œâ”€â”€ main.py                      # FastAPIåº”ç”¨å…¥å£
â”œâ”€â”€ requirements.txt             # Pythonä¾èµ–
â”œâ”€â”€ checklist_config.json         # æ£€æŸ¥æ¸…å•é…ç½®
â””â”€â”€ .gitignore                   # Gitå¿½ç•¥æ–‡ä»¶
```

---

## æ•°æ®æ¨¡å‹

### PaperStructure

è®ºæ–‡ç»“æ„çš„æ ¸å¿ƒæ•°æ®æ¨¡å‹ï¼ŒåŒ…å«ï¼š
- **å°é¢ä¿¡æ¯**: title, title_en, author, student_id, college, discipline, supervisor, defense_date
- **æ‘˜è¦**: abstract_cn, abstract_en
- **å…³é”®è¯**: keywords_cn, keywords_en
- **ç« èŠ‚**: chapters (List[ChapterInfo])
- **æ–‡æ¡£éƒ¨åˆ†**: sections (List[DocumentSection])
- **å†…å®¹ç»Ÿè®¡**: total_pages, word_count, char_count
- **æ ¼å¼ä¿¡æ¯**: page_formats, format_stats
- **å›¾è¡¨**: figures, tables
- **å‚è€ƒæ–‡çŒ®**: references

### ChapterInfo

ç« èŠ‚ä¿¡æ¯ï¼ŒåŒ…å«ï¼š
- **title**: ç« èŠ‚æ ‡é¢˜
- **page_idx**: èµ·å§‹é¡µç ï¼ˆå…¼å®¹æ€§ï¼‰
- **start_page**: èµ·å§‹é¡µç ï¼ˆ0-basedï¼‰
- **end_page**: ç»“æŸé¡µç ï¼ˆ0-basedï¼‰
- **level**: ç« èŠ‚çº§åˆ«ï¼ˆ1-3ï¼‰
- **number**: ç« èŠ‚ç¼–å·ï¼ˆå¦‚"ç¬¬ä¸€ç« "ã€"1.1"ï¼‰

### DocumentSection

æ–‡æ¡£éƒ¨åˆ†ä¿¡æ¯ï¼ŒåŒ…å«ï¼š
- **type**: éƒ¨åˆ†ç±»å‹ï¼ˆcover, abstract_cn, tocç­‰ï¼‰
- **title**: éƒ¨åˆ†æ ‡é¢˜
- **start_page**: èµ·å§‹é¡µç ï¼ˆ0-basedï¼‰
- **end_page**: ç»“æŸé¡µç ï¼ˆ0-basedï¼‰
- **content**: éƒ¨åˆ†å†…å®¹ï¼ˆå¯é€‰ï¼‰

---

## å…³é”®æŠ€æœ¯ç»†èŠ‚

### 1. è¿›åº¦æ›´æ–°æœºåˆ¶

ä½¿ç”¨Server-Sent Events (SSE)å®ç°å®æ—¶è¿›åº¦æ›´æ–°ï¼š

```python
async def progress_generator():
    queue = asyncio.Queue()
    
    # åœ¨åå°çº¿ç¨‹ä¸­è¿è¡Œè§£æ
    def parse_in_thread():
        parser.parse(progress_callback=lambda current, total, status:
            asyncio.run_coroutine_threadsafe(
                queue.put({'progress': ..., 'status': ...}),
                loop
            ))
    
    # ä»é˜Ÿåˆ—è¯»å–è¿›åº¦å¹¶å‘é€
    while True:
        data = await queue.get()
        yield f"data: {json.dumps(data)}\n\n"
```

### 2. è·¯å¾„å¤„ç†ä¼˜åŒ–

**é—®é¢˜**: Windowsè·¯å¾„åœ¨URLç¼–ç /è§£ç æ—¶å¯èƒ½ä¸¢å¤±åˆ†éš”ç¬¦

**è§£å†³æ–¹æ¡ˆ**:
```python
# 1. è§£ç URLç¼–ç 
decoded_path = urllib.parse.unquote(paper_path)

# 2. å°è¯•å¤šç§è·¯å¾„æ ¼å¼
path_variants = [
    Path(decoded_path),
    Path(decoded_path.replace('\\', '/')),
    Path(decoded_path.replace('/', '\\')),
]

# 3. å¦‚æœæ‰¾ä¸åˆ°ï¼Œåœ¨uploadsç›®å½•ä¸‹æŸ¥æ‰¾
# 4. æ”¯æŒæ–‡ä»¶åæ¨¡ç³ŠåŒ¹é…
```

### 3. ä¸­æ–‡å­—ä½“å¤„ç†

PDFæŠ¥å‘Šç”Ÿæˆæ—¶æ³¨å†Œä¸­æ–‡å­—ä½“ï¼š

```python
def _register_chinese_fonts():
    # Windows: SimSun, Microsoft YaHei, SimHei
    # macOS: STHeiti, PingFang
    # Linux: WenQuanYi Micro Hei
    
    # æ£€æµ‹ç³»ç»Ÿå­—ä½“å¹¶æ³¨å†Œåˆ°reportlab
    for font_name in chinese_fonts:
        if font_path.exists():
            pdfmetrics.registerFont(TTFont(font_name, str(font_path)))
```

### 4. é”™è¯¯å¤„ç†

- **æ–‡ä»¶ä¸å­˜åœ¨**: æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå¯ç”¨çš„æ–‡ä»¶åˆ—è¡¨
- **JSONè¯»å–å¤±è´¥**: å›é€€åˆ°PDFç›´æ¥è§£æ
- **LLMæœåŠ¡ä¸å¯ç”¨**: è·³è¿‡AIå®¡æŸ¥ï¼Œåªæ‰§è¡Œè§„åˆ™æ£€æŸ¥

---

## ä¼˜åŒ–ç­–ç•¥

### 1. å‡å°‘LLMè°ƒç”¨

- **ä¹‹å‰**: æ¯ä¸ªæ£€æŸ¥é¡¹å•ç‹¬è°ƒç”¨LLMï¼ˆ10+æ¬¡è°ƒç”¨ï¼‰
- **ç°åœ¨**: åˆå¹¶ä¸ºä¸€æ¬¡"ç»¼åˆå®¡æŸ¥"è°ƒç”¨
- **æ•ˆæœ**: å®¡æŸ¥æ—¶é—´ä»å‡ åˆ†é’Ÿå‡å°‘åˆ°å‡ åç§’

### 2. æ™ºèƒ½ç¼“å­˜

- è§£æç»“æœä¿å­˜ä¸ºJSONæ–‡ä»¶
- ç»“æ„ä¿¡æ¯ä¿å­˜ä¸º_structure.json
- å®¡æŸ¥ç»“æœä¿å­˜ä¸º_review.json
- é¿å…é‡å¤è§£æå’Œå®¡æŸ¥

### 3. å¼‚æ­¥å¤„ç†

- PDFè§£æåœ¨åå°çº¿ç¨‹æ‰§è¡Œ
- ä½¿ç”¨asyncio.Queueä¼ é€’è¿›åº¦æ›´æ–°
- ä¸é˜»å¡ä¸»äº‹ä»¶å¾ªç¯

### 4. è·¯å¾„æŸ¥æ‰¾ä¼˜åŒ–

- æ”¯æŒå¤šç§è·¯å¾„æ ¼å¼
- æ™ºèƒ½æ–‡ä»¶æŸ¥æ‰¾ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰
- ç›´æ¥æŸ¥æ‰¾JSONæ–‡ä»¶ï¼ˆå¦‚æœPDFè·¯å¾„æœ‰é—®é¢˜ï¼‰

---

## æœªæ¥æ”¹è¿›æ–¹å‘

1. **æ€§èƒ½ä¼˜åŒ–**
   - å¤§æ–‡ä»¶åˆ†å—å¤„ç†
   - å¹¶è¡Œé¡µé¢è§£æ
   - ç¼“å­˜ä¼˜åŒ–

2. **åŠŸèƒ½å¢å¼º**
   - æ”¯æŒæ›´å¤šæ–‡æ¡£æ ¼å¼
   - æ›´æ™ºèƒ½çš„ç»“æ„è¯†åˆ«
   - è‡ªå®šä¹‰å®¡æŸ¥è§„åˆ™

3. **ç”¨æˆ·ä½“éªŒ**
   - æ›´ä¸°å¯Œçš„å¯è§†åŒ–
   - æ‰¹é‡å¤„ç†åŠŸèƒ½
   - å†å²è®°å½•ç®¡ç†

---

## æ€»ç»“

è®ºæ–‡æ ¼å¼å®¡æŸ¥æ™ºèƒ½ä½“æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„PDFè§£æå’Œæ ¼å¼å®¡æŸ¥ç³»ç»Ÿï¼Œæ ¸å¿ƒç‰¹ç‚¹ï¼š

1. **å¤šå±‚çº§è§£æ**: ä»é¡µé¢çº§åˆ«åˆ°æ–‡æ¡£çº§åˆ«çš„å®Œæ•´è§£æ
2. **æ™ºèƒ½ç»“æ„æå–**: åŸºäºé¡µçœ‰å’Œå…³é”®è¯çš„æ··åˆæ–¹æ³•
3. **çµæ´»å®¡æŸ¥**: å¯é…ç½®çš„è§„åˆ™å’ŒAIè¾…åŠ©åˆ†æ
4. **å‹å¥½ç•Œé¢**: å®æ—¶è¿›åº¦ã€ç»“æ„é¢„è§ˆã€å†…å®¹æŸ¥çœ‹

ç³»ç»Ÿè®¾è®¡æ³¨é‡ï¼š
- **å‡†ç¡®æ€§**: ä¼˜å…ˆä½¿ç”¨JSONæ–‡ä»¶çš„markdownæ•°æ®
- **æ€§èƒ½**: å‡å°‘LLMè°ƒç”¨ï¼Œæ™ºèƒ½ç¼“å­˜
- **ç”¨æˆ·ä½“éªŒ**: å®æ—¶åé¦ˆï¼Œå‹å¥½çš„é”™è¯¯å¤„ç†
- **å¯æ‰©å±•æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½



